To sync your Replit project with your live server, you need to update these three specific files.

Copy and paste the code blocks below into the corresponding files in your Replit editor.

1. File: generated_backend/requirements.txt
Add the monitoring library to the bottom of the list.

Plaintext

flask==3.0.2
redis==5.0.1
rq==1.16.0
requests==2.31.0
gunicorn==21.2.0
psutil==5.9.8
2. File: generated_backend/app.py
This contains the new API status endpoint and the simplified priority routing.

Python

from flask import Flask, request, jsonify
from redis import Redis
from rq import Queue, Worker
import os
import logging
import psutil
import subprocess
import shutil

# Configure logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

app = Flask(__name__)

# SECURITY
API_KEY = os.getenv('API_KEY')

# Redis Connection
redis_conn = Redis(
    host=os.getenv('REDIS_HOST', 'localhost'),
    port=int(os.getenv('REDIS_PORT', 6379)),
    password=os.getenv('REDIS_PASSWORD', None)
)

# Queues
q_high = Queue('high', connection=redis_conn)
q_default = Queue('default', connection=redis_conn)
q_low = Queue('low', connection=redis_conn)
q_long = Queue('long_docs', connection=redis_conn)

def get_gpu_stats():
    """Parses nvidia-smi for GPU usage."""
    if not shutil.which('nvidia-smi'):
        return {"load": 0, "memory": 0, "mem_used_mb": 0}
    try:
        # Get GPU Load and Memory Used
        output = subprocess.check_output(
            ["nvidia-smi", "--query-gpu=utilization.gpu,memory.used,memory.total", "--format=csv,noheader,nounits"],
            encoding='utf-8'
        )
        util, mem_used, mem_total = map(int, output.strip().split(', '))
        mem_percent = round((mem_used / mem_total) * 100, 1)
        return {"load": util, "memory": mem_percent, "mem_used_mb": mem_used}
    except Exception:
        return {"load": 0, "memory": 0, "mem_used_mb": 0}

@app.route('/api/status', methods=['GET'])
def get_status():
    client_key = request.headers.get('X-API-Key')
    if client_key != API_KEY:
        # Strict security: Require key even for dashboard
        return jsonify({'error': 'Unauthorized'}), 401

    try:
        # 1. Redis Logs
        raw_logs = redis_conn.lrange("monitor_logs", 0, 19)
        logs = [log.decode('utf-8') for log in raw_logs]

        # 2. Queue Depths
        queues = {
            "high": len(q_high),
            "default": len(q_default),
            "low": len(q_low),
            "long_docs": len(q_long)
        }
        total_depth = sum(queues.values())

        # 3. Worker Status
        workers = Worker.all(connection=redis_conn)
        active_count = sum(1 for w in workers if w.state == 'busy')
        
        # 4. System Resources
        sys_stats = {
            "cpu": psutil.cpu_percent(interval=None),
            "ram": psutil.virtual_memory().percent,
            "gpu": get_gpu_stats()
        }

        return jsonify({
            "status": "online" if active_count > 0 else "idle",
            "queue_depth": total_depth,
            "active_workers": len(workers),
            "working_count": active_count,
            "queues": queues,
            "system": sys_stats,
            "logs": logs
        })
    except Exception as e:
        logger.error(f"Status Error: {e}")
        return jsonify({"error": str(e)}), 500

@app.route('/api/process_po', methods=['POST'])
def process_po():
    client_key = request.headers.get('X-API-Key')
    if client_key != API_KEY:
        return jsonify({'error': 'Unauthorized'}), 401

    try:
        data = request.get_json()
        
        required_fields = ['record_id', 'po_text', 'target_table_id', 'target_field_ids', 'prompt_json']
        if any(f not in data for f in required_fields):
            return jsonify({'error': 'Missing fields'}), 400

        # Routing Logic
        priority = data.get('priority', 'normal').lower()
        text_len = len(data.get('po_text', '') or "")
        LONG_DOC_THRESHOLD = 20000
        
        selected_queue = q_default
        queue_name = "default"

        if text_len > LONG_DOC_THRESHOLD:
            selected_queue = q_long
            queue_name = "long_docs"
        elif priority == 'high':
            selected_queue = q_high
            queue_name = "high"
        elif priority == 'low':
            selected_queue = q_low
            queue_name = "low"
        else:
            selected_queue = q_default
            queue_name = "default"

        from worker import process_po_job
        job = selected_queue.enqueue(
            process_po_job,
            args=(data,),
            job_timeout='60m'
        )
        
        logger.info(f"Enqueued record {data['record_id']} to {queue_name}")
        
        return jsonify({
            'status': 'queued',
            'queue': queue_name,
            'job_id': job.get_id(),
            'message': f'Record {data["record_id"]} added to {queue_name} queue'
        }), 202
        
    except Exception as e:
        return jsonify({'error': str(e)}), 500

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
3. File: client/src/pages/dashboard.tsx
This is the React frontend that displays the gauges and logs.

TypeScript

import { useEffect, useState } from "react";
import Layout from "@/components/layout";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Activity, Server, Zap } from "lucide-react";

export default function Dashboard() {
  const [data, setData] = useState<any>(null);
  const [error, setError] = useState("");

  // Poll API every 1 second
  useEffect(() => {
    const fetchData = async () => {
      try {
        const res = await fetch("https://americanpower-ai2.westus2.cloudapp.azure.com/api/status", {
          headers: { "X-API-Key": "q#*3VyUK6&ih63xZ" }
        });
        if (res.ok) {
          setData(await res.json());
          setError("");
        } else {
          setError("Auth Error");
        }
      } catch (e) {
        setError("Connection Failed");
      }
    };
    fetchData();
    const interval = setInterval(fetchData, 1000);
    return () => clearInterval(interval);
  }, []);

  if (error) return <div className="p-10 text-red-500 bg-slate-950 h-screen flex items-center justify-center font-mono">{error}</div>;
  if (!data) return <div className="p-10 text-emerald-500 bg-slate-950 h-screen flex items-center justify-center font-mono animate-pulse">INITIALIZING NEURAL LINK...</div>;

  return (
    <Layout>
      <div className="space-y-6">
        {/* ROW 1: KEY METRICS */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          {/* Queue Depth */}
          <Card className="bg-slate-900 border-slate-800 text-white">
            <CardHeader className="pb-2"><CardTitle className="text-xs font-mono text-slate-400 uppercase tracking-widest">Queue Depth</CardTitle></CardHeader>
            <CardContent>
              <div className="text-4xl font-bold font-mono">{data.queue_depth}</div>
              <p className="text-[10px] text-slate-500 uppercase mt-1">Pending Documents</p>
            </CardContent>
          </Card>

          {/* GPU Load */}
          <Card className="bg-slate-900 border-slate-800 text-white">
            <CardHeader className="pb-2"><CardTitle className="text-xs font-mono text-slate-400 uppercase tracking-widest flex items-center gap-2"><Zap className="w-3 h-3 text-yellow-500"/> Tesla T4 Load</CardTitle></CardHeader>
            <CardContent>
              <div className="flex items-baseline gap-2">
                <div className={`text-4xl font-bold font-mono ${data.system.gpu.load > 80 ? 'text-red-400' : 'text-emerald-400'}`}>{data.system.gpu.load}%</div>
                <div className="text-[10px] text-slate-500 uppercase">Compute</div>
              </div>
              <div className="w-full bg-slate-800 h-1 mt-3 rounded-full overflow-hidden">
                <div className="bg-emerald-500 h-full transition-all duration-300" style={{ width: `${data.system.gpu.load}%` }}></div>
              </div>
            </CardContent>
          </Card>

          {/* VRAM Usage */}
          <Card className="bg-slate-900 border-slate-800 text-white">
            <CardHeader className="pb-2"><CardTitle className="text-xs font-mono text-slate-400 uppercase tracking-widest">VRAM Usage</CardTitle></CardHeader>
            <CardContent>
               <div className="flex items-baseline gap-2">
                <div className="text-4xl font-bold font-mono text-purple-400">{data.system.gpu.memory}%</div>
                <div className="text-[10px] text-slate-500 uppercase">{Math.round(data.system.gpu.mem_used_mb / 1024)} GB / 15 GB</div>
              </div>
               <div className="w-full bg-slate-800 h-1 mt-3 rounded-full overflow-hidden">
                <div className="bg-purple-500 h-full transition-all duration-300" style={{ width: `${data.system.gpu.memory}%` }}></div>
              </div>
            </CardContent>
          </Card>
          
           {/* System RAM */}
           <Card className="bg-slate-900 border-slate-800 text-white">
            <CardHeader className="pb-2"><CardTitle className="text-xs font-mono text-slate-400 uppercase tracking-widest">System RAM</CardTitle></CardHeader>
            <CardContent>
              <div className="flex items-baseline gap-2">
                <div className="text-4xl font-bold font-mono text-blue-400">{data.system.ram}%</div>
                <div className="text-[10px] text-slate-500 uppercase">Usage</div>
              </div>
              <div className="w-full bg-slate-800 h-1 mt-3 rounded-full overflow-hidden">
                <div className="bg-blue-500 h-full transition-all duration-300" style={{ width: `${data.system.ram}%` }}></div>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* ROW 2: LOGS & WORKERS */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {/* Logs Console */}
            <Card className="md:col-span-2 bg-black border-slate-800 text-white">
            <CardHeader className="border-b border-slate-800 py-3"><CardTitle className="text-xs font-mono uppercase tracking-widest flex items-center gap-2"><Activity className="w-3 h-3 text-green-500"/> Live Processing Stream</CardTitle></CardHeader>
            <CardContent className="p-0">
                <div className="font-mono text-[10px] md:text-xs h-64 overflow-hidden flex flex-col-reverse p-4 bg-black/50 relative">
                {data.logs.map((log: string, i: number) => (
                    <div key={i} className="mb-1 border-b border-white/5 pb-0.5 text-green-400/80 truncate">
                    <span className="opacity-40 mr-3 text-slate-400">[{new Date().toLocaleTimeString()}]</span>
                    {log.replace(/\[.*?\]/, '').trim()}
                    </div>
                ))}
                </div>
            </CardContent>
            </Card>

            {/* Worker Status List */}
            <Card className="bg-slate-900 border-slate-800 text-white">
                <CardHeader className="border-b border-slate-800 py-3"><CardTitle className="text-xs font-mono uppercase tracking-widest flex items-center gap-2"><Server className="w-3 h-3 text-blue-500"/> Worker Status</CardTitle></CardHeader>
                <CardContent className="p-4 space-y-3">
                    <div className="flex justify-between items-center text-xs font-mono">
                        <span className="text-slate-400">Active Workers</span>
                        <span className="text-emerald-400">{data.active_workers} Online</span>
                    </div>
                    <div className="flex justify-between items-center text-xs font-mono">
                         <span className="text-slate-400">Status</span>
                         <span className={`px-2 py-0.5 rounded text-[10px] uppercase font-bold ${data.status === 'processing' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-slate-800 text-slate-500'}`}>
                             {data.status}
                         </span>
                    </div>
                     <div className="pt-4 border-t border-slate-800">
                        <div className="text-[10px] uppercase text-slate-500 mb-2 font-mono">Queue Breakdown</div>
                        <div className="grid grid-cols-2 gap-2">
                             <div className="bg-slate-950 p-2 rounded border border-slate-800">
                                <div className="text-xs font-bold text-red-400">{data.queues.high}</div>
                                <div className="text-[9px] text-slate-500 uppercase">High</div>
                             </div>
                             <div className="bg-slate-950 p-2 rounded border border-slate-800">
                                <div className="text-xs font-bold text-blue-400">{data.queues.default}</div>
                                <div className="text-[9px] text-slate-500 uppercase">Std</div>
                             </div>
                             <div className="bg-slate-950 p-2 rounded border border-slate-800">
                                <div className="text-xs font-bold text-slate-400">{data.queues.low}</div>
                                <div className="text-[9px] text-slate-500 uppercase">Low</div>
                             </div>
                             <div className="bg-slate-950 p-2 rounded border border-slate-800">
                                <div className="text-xs font-bold text-orange-400">{data.queues.long_docs}</div>
                                <div className="text-[9px] text-slate-500 uppercase">Long</div>
                             </div>
                        </div>
                     </div>
                </CardContent>
            </Card>
        </div>
      </div>
    </Layout>
  );
}